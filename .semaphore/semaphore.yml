version: v1.0
name: Initial Pipeline
agent:
  machine:
    type: e1-standard-8
    os_image: ubuntu1804

blocks:
  - name: CI
    task:
      jobs:
        - name: Build
          parallelism: 2
          commands:
            - sem-version python 3.7
            - sudo mkdir /opt/sdk
            - sudo chown $USER /opt/sdk
            - df -h
            - cache list
            - cache restore zephyr-sdk-0.10.3
            - cache --help
            - wget -O - https://apt.kitware.com/keys/kitware-archive-latest.asc 2>/dev/null | sudo apt-key add -
            - sudo apt-add-repository 'deb https://apt.kitware.com/ubuntu/ bionic main'
            - install-package git cmake ninja-build gperf
              ccache dfu-util device-tree-compiler wget python3-pip python3-setuptools
              python3-wheel xz-utils file make gcc gcc-multilib
            - pip3 install --user -U west
            - export PATH=~/.local/bin:"$PATH"
            - pip3 install -r https://raw.githubusercontent.com/zephyrproject-rtos/zephyr/master/scripts/requirements.txt --user
            - ls /opt/sdk/zephyr-sdk-0.10.3
            - echo wget https://github.com/zephyrproject-rtos/sdk-ng/releases/download/v0.10.3/zephyr-sdk-0.10.3-setup.run
            - echo chmod +x zephyr-sdk-0.10.3-setup.run
            - echo ./zephyr-sdk-0.10.3-setup.run --quiet -- -d /opt/sdk/zephyr-sdk-0.10.3
            - cache list
            - echo cache store zephyr-sdk-0.10.3 /opt/sdk/zephyr-sdk-0.10.3
            - cache list
            - checkout --use-cache
            - west init -l .
            - ls
            - pwd
            - source .semaphore/docker_run.sh
